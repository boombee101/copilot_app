<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TVA Copilot Help Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Use the classic stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style_classic.css') }}">
</head>
<body>
  <div class="disclaimer">
    ‚ö†Ô∏è Do not input, upload, or share any TVA-sensitive, personal, or confidential information in this tool. Use general descriptions only.
  </div>

  <div class="header">
    <div class="header-content">
      <img src="/static/images/tva_logo.png" alt="TVA Logo" />
      <div class="title">TVA Copilot Help Center</div>
      <div class="subtitle">Smart support for Microsoft 365 ‚Äî built for TVA employees</div>
    </div>
  </div>

  <div class="container">
    <div class="layout">
      <!-- Left: Prompt Builder (classic styling) -->
      <div>
        <h2>Prompt Builder</h2>
        <p class="lead">
          Tell us your task. We‚Äôll ask short follow‚Äëup questions and generate a clean Copilot prompt. You can also get step‚Äëby‚Äëstep manual instructions.
        </p>

        <form method="POST" action="{{ url_for('home') }}">
          <div class="section">
            <label for="app">Microsoft app</label>
            <select id="app" name="app" required>
              {% set current_app = app_selected if app_selected else 'Word' %}
              {% for a in ['Word','Excel','Outlook','Teams','PowerPoint'] %}
                <option value="{{a}}" {% if a==current_app %}selected{% endif %}>{{a}}</option>
              {% endfor %}
            </select>
            <div class="hint">Choose where you‚Äôll run the prompt.</div>
          </div>

          <div class="section">
            <label for="task">What do you want to do?</label>
            <input id="task" name="task" type="text" placeholder="Example: Summarize a report for shift handoff" value="{{ original_task or '' }}" required />
            <div class="hint">Use general wording. No sensitive content.</div>
          </div>

          {% if presets and presets.common_tasks %}
          <div class="badges">
            {% for p in presets.common_tasks %}
              <button class="btn-soft" type="button" onclick="fillTask('{{p}}')">üìå {{p}}</button>
            {% endfor %}
          </div>
          {% endif %}

          <!-- Advanced toggle (kept simple; same backend fields) -->
          <details class="section">
            <summary><b>Show advanced options</b></summary>
            <div class="section">
              <label for="audience">Audience</label>
              <input id="audience" name="audience" type="text" placeholder="Who will read this? (e.g., shift supervisors)" />
            </div>
            <div class="section">
              <label for="tone">Tone</label>
              <input id="tone" name="tone" type="text" placeholder="Plain, professional, friendly" />
            </div>
            <div class="section">
              <label for="length_limit">Length limit</label>
              <input id="length_limit" name="length_limit" type="text" placeholder="Example: 200 words" />
            </div>
            <div class="section">
              <label for="format_pref">Preferred output format</label>
              <input id="format_pref" name="format_pref" type="text" placeholder="Bullets, outline, table, slide outline" />
            </div>
            <div class="section">
              <label for="must_include">Must include</label>
              <input id="must_include" name="must_include" type="text" placeholder="Key items Copilot must cover" />
            </div>
            <div class="section">
              <label for="must_exclude">Do not include</label>
              <input id="must_exclude" name="must_exclude" type="text" placeholder="Words, topics, or details to avoid" />
            </div>
            <div class="section">
              <label for="deadline">Deadline or timing</label>
              <input id="deadline" name="deadline" type="text" placeholder="Example: before 7:00 AM daily" />
            </div>
            <div class="section">
              <label for="style_guide">Style preferences</label>
              <input id="style_guide" name="style_guide" type="text" placeholder="Short sentences, no jargon" />
            </div>
          </details>

          <div class="section">
            <button class="button" type="submit">Generate Questions</button>
          </div>
        </form>

        {% if questions %}
          <hr class="divider" />
          <h2>Follow‚Äëup Questions</h2>
          <p class="lead">Answer in plain language. If you do not know something, leave it blank.</p>
          <form method="POST" action="{{ url_for('home') }}">
            <input type="hidden" name="original_task" value="{{ original_task }}" />
            {% for q in questions %}
              <div class="section">
                <label>Q{{ loop.index }}. {{ q }}</label>
                <textarea name="answer_{{ loop.index0 }}" placeholder="Type your answer here"></textarea>
              </div>
            {% endfor %}
            <div class="panel">Reminder: Do not paste sensitive information. Use general descriptions.</div>
            <div class="section">
              <button class="button" type="submit">Build Prompt</button>
            </div>
          </form>
        {% endif %}
      </div>

      <!-- Right: Results / Manual / History -->
      <div>
        <h2>Results</h2>

        {% if final_prompt %}
          <div class="section"><b>Copilot Prompt</b></div>
          <div class="panel mono" id="promptBox">{{ final_prompt }}</div>
          <div class="section">
            <button class="button" type="button" onclick="copyText('promptBox')">Copy prompt</button>
          </div>
        {% else %}
          <div class="panel">Your prompt will appear here after you answer the questions and click <b>Build Prompt</b>.</div>
        {% endif %}

        <div class="section"><b>Manual Steps</b></div>
        <div class="panel mono" id="manualBox">
{% if manual_instructions %}
{{ manual_instructions }}
{% else %}
No steps yet. After you build the prompt, we‚Äôll also generate beginner-friendly instructions here.
{% endif %}
        </div>
        <div class="section">
          <button class="button" type="button" onclick="copyText('manualBox')">Copy steps</button>
        </div>

        <h2>Recent Prompts</h2>
        {% if history and history|length > 0 %}
          {% for h in history %}
            <div class="history-item">
              <div class="history-meta">{{ h.timestamp }} ‚Ä¢ {{ h.app }}</div>
              <div><b>Task:</b> {{ h.task }}</div>
              <details style="margin-top:6px">
                <summary>Show context</summary>
                <div class="mono" style="margin-top:6px">{{ h.context }}</div>
              </details>
              <details style="margin-top:6px">
                <summary>Show prompt</summary>
                <div class="mono" style="margin-top:6px">{{ h.prompt }}</div>
              </details>
            </div>
          {% endfor %}
        {% else %}
          <div class="history-item"><div class="history-meta">No recent prompts yet.</div></div>
        {% endif %}
      </div>
    </div>

    <div class="footer">SQN Copilot Companion</div>
  </div>

  <script>
    function fillTask(t){ const el=document.getElementById('task'); el.value=t; el.focus(); }
    function copyText(id){
      const el=document.getElementById(id); if(!el) return;
      const sel=window.getSelection(), range=document.createRange();
      range.selectNodeContents(el); sel.removeAllRanges(); sel.addRange(range);
      document.execCommand('copy'); sel.removeAllRanges();
    }
  </script>
</body>
</html>
