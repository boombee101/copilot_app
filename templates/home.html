<!-- =============================
FILE: templates/home.html
Extends base. No features removed; forms still post to existing endpoints.
============================= -->
{% extends 'layout.html' %}
{% set page_id='home' %}
{% set page_title='SQN Copilot Companion — Home' %}
{% set header_title='Home' %}
{% set page_meta='Beginner‑friendly guidance • Manual steps + Copilot prompts' %}

{% block content %}
  <div class="grid">
    <!-- Task card -->
    <div class="card">
      <h2>What do you want to do?</h2>
      <p class="sub">Pick your Microsoft 365 app and describe your task in plain English. We’ll ask for missing details, then show both a Copilot prompt and manual steps.</p>
      <form action="{{ url_for('ask_gpt') if 'ask_gpt' in globals() else '/ask_gpt' }}" method="post">
        <div class="field">
          <label for="app">Microsoft 365 app</label>
          <select id="app" name="app" required>
            <option value="Word" {% if (app or request.form.get('app',''))=='Word' %}selected{% endif %}>Word</option>
            <option value="Excel" {% if (app or request.form.get('app',''))=='Excel' %}selected{% endif %}>Excel</option>
            <option value="Outlook" {% if (app or request.form.get('app',''))=='Outlook' %}selected{% endif %}>Outlook</option>
            <option value="Teams" {% if (app or request.form.get('app',''))=='Teams' %}selected{% endif %}>Teams</option>
            <option value="PowerPoint" {% if (app or request.form.get('app',''))=='PowerPoint' %}selected{% endif %}>PowerPoint</option>
          </select>
        </div>
        <div class="field">
          <label for="task">Describe your task or problem</label>
          <textarea id="task" name="task" placeholder="Example: Clean up a messy table and create a chart that highlights the 5 biggest cost drivers." required>{{ task if task is defined else request.form.get('task','') }}</textarea>
        </div>
        <div class="row">
          <button class="btn" type="submit" name="mode" value="generate">Generate Copilot prompt</button>
          <button class="btn secondary" type="submit" name="mode" value="manual">Show manual steps</button>
          <button class="btn ghost" type="reset">Clear</button>
        </div>
      </form>
    </div>

    <!-- Helper / Explainer -->
    <div class="card helper">
      <div>
        <h2>How this page works</h2>
        <p class="sub">We keep it simple and practical.</p>
        <div class="quick">
          <div>• You type your goal in your own words.</div>
          <div>• We ask follow‑up questions when needed.</div>
          <div>• You get two outputs every time: a polished Copilot prompt and plain manual steps you can follow now.</div>
        </div>
      </div>
      <div class="disclosure">
        <strong>Reminder:</strong> Do not enter sensitive or confidential TVA information. Use sample or generic data. This tool is for learning and productivity.
      </div>
    </div>
  </div>

  <!-- Results area (only shows when data exists) -->
  {% set _prompt = prompt if prompt is defined else (final_prompt if final_prompt is defined else (prompt_output if prompt_output is defined else None)) %}
  {% set _manual = manual_instructions if manual_instructions is defined else (manual_steps if manual_steps is defined else (manual_output if manual_output is defined else None)) %}
  {% set _questions = questions if questions is defined else (follow_up_questions if follow_up_questions is defined else None) %}

  {% if _questions or _prompt or _manual %}
  <div class="grid" style="margin-top:var(--gap)">
    {% if _questions %}
    <div class="card">
      <div class="result-title">
        <h2>Follow‑up questions</h2>
        <span class="badge">Help us be specific</span>
      </div>
      <form action="{{ url_for('ask_gpt') if 'ask_gpt' in globals() else '/ask_gpt' }}" method="post">
        <input type="hidden" name="app" value="{{ app if app is defined else request.form.get('app','') }}" />
        <input type="hidden" name="task" value="{{ task if task is defined else request.form.get('task','') }}" />
        <div class="field">
          <label>Answer the questions below. You can skip any that don’t apply.</label>
          {% for q in _questions %}
            <div class="field">
              <label>{{ q }}</label>
              <input type="text" name="q{{ loop.index }}" placeholder="Your answer" />
            </div>
          {% endfor %}
        </div>
        <div class="row">
          <button class="btn" type="submit" name="mode" value="refine">Update prompt</button>
        </div>
      </form>
    </div>
    {% endif %}

    {% if _prompt or _manual %}
    <div class="card" style="grid-column:1 / -1">
      <div class="result-wrap">
        <div>
          <div class="result-title">
            <h2>Copilot prompt</h2>
            <span class="badge">Ready to copy</span>
          </div>
          {% if _prompt %}
            <pre>{{ _prompt }}</pre>
          {% else %}
            <pre>Run “Generate Copilot prompt” to see your prompt here.</pre>
          {% endif %}
        </div>
        <div>
          <div class="result-title">
            <h2>Manual steps</h2>
            <span class="badge">Do it now</span>
          </div>
          {% if _manual %}
            <pre>{{ _manual }}</pre>
          {% else %}
            <pre>Run “Show manual steps” to get a simple, step‑by‑step guide here.</pre>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  {% endif %}
{% endblock %}
