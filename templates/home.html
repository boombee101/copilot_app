<!-- =============================
FILE: templates/home.html
Home page wired to app.py routes:
- Main form POSTs to /home
- Uses app_selected and original_task
- Follow-up answers named answer_0, answer_1, ...
- Teach Me → /learn/word
- Troubleshooter → /troubleshooter
- Prompt Builder → /prompt_builder
============================= -->
{% extends 'layout.html' %}
{% block title %}SQN Copilot Companion — Home{% endblock %}
{% block page_title %}Home{% endblock %}
{% block page_meta %}Beginner friendly guidance • Manual steps + Copilot prompts{% endblock %}

{% block extra_styles %}
<style>
  html { scroll-behavior: smooth; }
  section { scroll-margin-top: 80px; }

  .hero{display:grid;gap:12px;margin-bottom:var(--gap)}
  .hero h1{font-size:28px;margin:0}
  .hero p{margin:0;color:var(--tva-slate);font-size:15px}
  .cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .pill{display:inline-block;border:1px solid #d9e8fa;background:#f7fbff;border-radius:999px;padding:6px 10px;font-size:12px;color:#0a2b4f;text-decoration:none}
  .pill:hover{background:#eef6ff}

  /* How it works */
  .how h2{margin:0 0 6px 0}
  .section-intro{margin:4px 0 14px 0;color:var(--tva-slate);font-size:14.5px}
  .steps-list{margin:0;padding:0;list-style:none;display:grid;gap:12px}
  .steps-list > li{background:#ffffff;border:1px solid #e6edf7;border-radius:12px;padding:14px}
  .steps-list h4{margin:0 0 6px 0;font-size:16px;color:#0b3a75}
  .steps-list p{margin:0 0 6px 0;color:#234}
  .steps-list ul{margin:0;padding-left:18px;color:#445}
  .steps-list ul li{margin:2px 0}

  /* Features */
  .feature-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap)}
  .feature{background:#ffffff;border:1px solid #e6edf7;border-radius:12px;padding:16px;display:grid;gap:10px}
  .feature-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .feature-head .tag{font-size:12px;color:#336;background:#eef3fb;border:1px solid #d9e8fa;border-radius:999px;padding:2px 8px}
  .feature p{margin:0;color:#223}
  .btn{display:inline-block;margin-top:6px;padding:8px 12px;border-radius:8px;background:#0b5fd7;color:#fff;text-decoration:none}
  .btn:hover{background:#094fb3}

  @media (max-width:1024px){
    .feature-grid{grid-template-columns:1fr}
  }

  /* Keep your existing minis for the small cards if needed elsewhere */
  .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap)}
  .mini{display:flex;gap:10px;align-items:flex-start;background:#ffffff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .mini .ic{width:28px;height:28px;border-radius:9px;background:#e9f0fb;display:inline-flex;align-items:center;justify-content:center;font-weight:700}

  /* Links inside features if used */
  .feature a{font-weight:600;text-decoration:none;color:#0b5fd7}
  .feature a:hover{text-decoration:underline}
</style>
{% endblock %}

{% block content %}

<!-- Hero Intro -->
<section class="hero card" id="top">
  <h1>Welcome to SQN Copilot Companion</h1>
  <p>
    An assistant for Microsoft 365. Describe the goal, get missing details collected automatically,
    then receive a clean Copilot prompt and simple manual steps.
  </p>
  <div class="cta-row">
    <a class="pill" href="#task-form">Start a task</a>
    <a class="pill" href="#how">How it works</a>
    <a class="pill" href="#features">What you can do</a>
    <a class="pill" href="#safety">Safety and privacy</a>
  </div>
</section>

<!-- How it works (rewritten and expanded) -->
<section id="how" class="how card">
  <h2>How it works</h2>
  <p class="section-intro">
    Start with a task in any Microsoft 365 app. The assistant asks for missing details, then shows a polished Copilot prompt and plain‑language manual steps.
  </p>

  <ol class="steps-list">
    <li>
      <h4>Pick an app</h4>
      <p>Select Word, Excel, Outlook, Teams, or PowerPoint.</p>
      <ul>
        <li>New to an app? Open Teach Me for short lessons.</li>
        <li>Not sure which app fits? Describe the goal in plain English.</li>
      </ul>
    </li>
    <li>
      <h4>Describe the goal</h4>
      <p>Type the outcome that is needed in simple terms.</p>
      <ul>
        <li>Examples: “Clean this table and chart the top five costs” or “Draft a two‑paragraph update from these notes.”</li>
        <li>Targeted follow‑up questions appear if more detail is needed.</li>
      </ul>
    </li>
    <li>
      <h4>Choose how to proceed</h4>
      <p>Copy the ready‑to‑use Copilot prompt or follow the manual steps.</p>
      <ul>
        <li>Prompts are tailored to the selected app and task.</li>
        <li>Manual steps are beginner friendly and easy to follow.</li>
      </ul>
    </li>
  </ol>
</section>

<div class="grid">
  <!-- Task card -->
  <section class="card" id="task-form">
    <h2>What do you want to do?</h2>
    <p class="sub">Pick an app and describe the task. Follow‑up questions help fill in the gaps, then the Copilot prompt and manual steps are shown side by side.</p>

    <!-- IMPORTANT: Posts to /home, matching app.py -->
    <form action="{{ url_for('home') }}" method="post">
      <div class="field">
        <label for="app">Microsoft 365 app</label>
        {% set selected_app = (app_selected if app_selected is defined else request.form.get('app','')) %}
        <select id="app" name="app" required>
          <option value="Word" {% if selected_app=='Word' %}selected{% endif %}>Word</option>
          <option value="Excel" {% if selected_app=='Excel' %}selected{% endif %}>Excel</option>
          <option value="Outlook" {% if selected_app=='Outlook' %}selected{% endif %}>Outlook</option>
          <option value="Teams" {% if selected_app=='Teams' %}selected{% endif %}>Teams</option>
          <option value="PowerPoint" {% if selected_app=='PowerPoint' %}selected{% endif %}>PowerPoint</option>
        </select>
      </div>

      <div class="field">
        <label for="task">Describe your task or problem</label>
        <textarea id="task" name="task" required placeholder="Example: Clean this table and create a chart that highlights the five biggest cost drivers.">{{ task if task is defined else request.form.get('task','') }}</textarea>
      </div>

      <div class="row">
        <button class="btn" type="submit" name="mode" value="generate">Generate Copilot prompt</button>
        <button class="btn secondary" type="submit" name="mode" value="manual">Show manual steps</button>
        <button class="btn ghost" type="reset">Clear</button>
      </div>
    </form>
  </section>

  <!-- Feature spotlight (rewritten with all apps and richer details) -->
  <section class="card" id="features">
    <h2>What you can do here</h2>
    <p class="section-intro">
      Learn quickly, fix issues, or generate precise Copilot prompts across Microsoft 365.
    </p>

    <div class="feature-grid">
      <article class="feature">
        <div class="feature-head">
          <strong>Teach Me Microsoft 365</strong>
          <span class="tag">Word • Excel • Outlook • Teams • PowerPoint</span>
        </div>
        <p>Short, beginner lessons with plain steps. Useful for learning the basics or refreshing a skill before starting a task.</p>
        <a class="btn" href="{{ url_for('learn_app', app_name='word') }}">Open Teach Me</a>
      </article>

      <article class="feature">
        <div class="feature-head">
          <strong>Troubleshooter</strong>
          <span class="tag">Error codes • Crashes • “Not working”</span>
        </div>
        <p>Paste an error or describe the issue. Receive a simple diagnosis and clear, numbered steps to resolve it. For network issues, contact TVA IT.</p>
        <a class="btn" href="{{ url_for('troubleshooter') }}">Open Troubleshooter</a>
      </article>

      <article class="feature">
        <div class="feature-head">
          <strong>Prompt Builder</strong>
          <span class="tag">Word • Excel • Outlook • Teams • PowerPoint</span>
        </div>
        <p>Describe the goal, audience, and format. Get a clean, ready‑to‑paste Copilot prompt tailored to the app and outcome.</p>
        <a class="btn" href="{{ url_for('prompt_builder') }}">Open Prompt Builder</a>
      </article>
    </div>
  </section>
</div>

{# Resolve variables from app.py #}
{% set _prompt = final_prompt if final_prompt is defined else None %}
{% set _manual_text = manual_instructions if manual_instructions is defined else None %}
{% set _manual_html = manual_instructions_html if manual_instructions_html is defined else None %}
{% set _questions = questions if questions is defined else None %}

{% if _questions or _prompt or _manual_text or _manual_html %}
  <div class="grid" style="margin-top:var(--gap)">
    {% if _questions %}
    <!-- Follow up questions form. Names must be answer_0, answer_1, ... -->
    <section class="card">
      <div class="result-title">
        <h2>Follow up questions</h2>
        <span class="badge">Help refine the task</span>
      </div>
      <form action="{{ url_for('home') }}" method="post">
        <input type="hidden" name="original_task" value="{{ original_task or task or '' }}" />
        <div class="field">
          <label>Answer any that apply.</label>
          {% for q in _questions %}
            <div class="field">
              <label>{{ q }}</label>
              <input type="text" name="answer_{{ loop.index0 }}" placeholder="Your answer" />
            </div>
          {% endfor %}
        </div>
        <div class="row">
          <button class="btn" type="submit">Update prompt</button>
        </div>
      </form>
    </section>
    {% endif %}

    {% if _prompt or _manual_text or _manual_html %}
    <section class="card" style="grid-column:1 / -1">
      <div class="result-wrap">
        <div>
          <div class="result-title">
            <h2>Copilot prompt</h2>
            <span class="badge">Ready to copy</span>
          </div>
          {% if _prompt %}
            <pre>{{ _prompt }}</pre>
          {% else %}
            <pre>Run "Generate Copilot prompt" to see your prompt here.</pre>
          {% endif %}
        </div>
        <div>
          <div class="result-title">
            <h2>Manual steps</h2>
            <span class="badge">Do it now</span>
          </div>
          {% if _manual_html %}
            {{ _manual_html | safe }}
          {% elif _manual_text %}
            <pre>{{ _manual_text }}</pre>
          {% else %}
            <pre>Run "Show manual steps" to get a simple, step by step guide here.</pre>
          {% endif %}
        </div>
      </div>
    </section>
    {% endif %}
  </div>
{% endif %}

<!-- Safety and privacy -->
<section class="card" id="safety" style="margin-top:var(--gap)">
  <h2>Safety and privacy</h2>
  <p class="sub">Do not enter sensitive or confidential TVA information. Use sample or generic data. This tool is for learning and productivity.</p>
</section>

{% endblock %}
