<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SQN Copilot Companion ‚Ä¢ Prompt Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="disclaimer">‚ö†Ô∏è Do not input or share TVA-sensitive, personal, or confidential information. Use general descriptions only.</div>

  <div class="header">
    <div class="header-content">
      <img src="/static/images/tva_logo.png" alt="TVA Logo" />
      <div class="title">SQN Copilot Companion</div>
      <div class="subtitle">Prompt Builder, Manual Steps, and Help made simple</div>
    </div>
  </div>

  <div class="wrap two-col">
    <!-- Left: Builder -->
    <div class="card">
      <h2>Prompt Builder</h2>
      <p class="lead">Tell us your task. We‚Äôll ask short follow-up questions and generate a clean Copilot prompt. You can also get step-by-step manual instructions.</p>

      <!-- Step 1 -->
      <form method="POST" action="{{ url_for('home') }}">
        <div class="grid-2">
          <div>
            <label for="app">Microsoft app</label>
            <select id="app" name="app" required>
              {% set current_app = app_selected if app_selected else 'Word' %}
              {% for a in ['Word','Excel','Outlook','Teams','PowerPoint'] %}
                <option value="{{a}}" {% if a==current_app %}selected{% endif %}>{{a}}</option>
              {% endfor %}
            </select>
            <div class="hint">Choose where you‚Äôll run the prompt.</div>
          </div>
          <div>
            <label for="task">What do you want to do?</label>
            <input id="task" name="task" type="text" placeholder="Example: Summarize a report for shift handoff" value="{{ original_task or '' }}" required />
            <div class="hint">Use general wording. No sensitive content.</div>
          </div>
        </div>

        {% if presets and presets.common_tasks %}
        <div class="badges">
          {% for p in presets.common_tasks %}
            <button class="btn secondary" type="button" onclick="fillTask('{{p}}')">üìå {{p}}</button>
          {% endfor %}
        </div>
        {% endif %}

        <label class="switch" title="Advanced options">
          <input type="checkbox" id="advToggle" onclick="toggleAdv()" />
          <span>Show advanced options</span>
        </label>

        <div class="adv" id="advSection">
          <div class="grid-2">
            <div>
              <label for="audience">Audience</label>
              <input id="audience" name="audience" type="text" placeholder="Who will read this? (e.g., shift supervisors)" />
            </div>
            <div>
              <label for="tone">Tone</label>
              <input id="tone" name="tone" type="text" placeholder="Plain, professional, friendly" />
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="length_limit">Length limit</label>
              <input id="length_limit" name="length_limit" type="text" placeholder="Example: 200 words" />
            </div>
            <div>
              <label for="format_pref">Preferred output format</label>
              <input id="format_pref" name="format_pref" type="text" placeholder="Bullets, outline, table, slide outline" />
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="must_include">Must include</label>
              <input id="must_include" name="must_include" type="text" placeholder="Key items Copilot must cover" />
            </div>
            <div>
              <label for="must_exclude">Do not include</label>
              <input id="must_exclude" name="must_exclude" type="text" placeholder="Words, topics, or details to avoid" />
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="deadline">Deadline or timing</label>
              <input id="deadline" name="deadline" type="text" placeholder="Example: before 7:00 AM daily" />
            </div>
            <div>
              <label for="style_guide">Style preferences</label>
              <input id="style_guide" name="style_guide" type="text" placeholder="Short sentences, no jargon" />
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn" type="submit">üß≠ Generate Questions</button>
          <span class="hint">We‚Äôll ask only what we need.</span>
        </div>
      </form>

      <!-- Step 2 -->
      {% if questions %}
      <hr style="margin:22px 0;border:none;border-top:var(--line)" />
      <h2>Follow-up Questions</h2>
      <p class="lead">Answer in plain language. If you do not know something, leave it blank.</p>
      <form method="POST" action="{{ url_for('home') }}">
        <input type="hidden" name="original_task" value="{{ original_task }}" />
        <div class="qa">
          {% for q in questions %}
            <div>
              <div class="q"><strong>Q{{ loop.index }}.</strong> {{ q }}</div>
              <div class="a"><textarea name="answer_{{
                loop.index0 }}" placeholder="Type your answer here"></textarea></div>
            </div>
          {% endfor %}
        </div>
        <div class="note">Reminder: Do not paste sensitive information. Use general descriptions.</div>
        <div class="row" style="margin-top:12px">
          <button class="btn" type="submit">üõ†Ô∏è Build Prompt</button>
          <a class="btn secondary" href="#top" onclick="scrollToTop();return false;">Back to top</a>
        </div>
      </form>
      {% endif %}
    </div>

    <!-- Right: Results + History -->
    <div class="card">
      <h2>Results</h2>

      {% if final_prompt %}
      <div class="panel-title"><strong>Copilot Prompt</strong></div>
      <div class="copybar">
        <button class="btn copy" onclick="copyText('promptBox')">Copy prompt</button>
      </div>
      <div id="promptBox" class="mono">{{ final_prompt }}</div>
      {% else %}
      <div class="note">Your prompt will appear here after you answer the questions and click Build Prompt.</div>
      {% endif %}

      <div style="margin-top:18px"></div>
      <div class="panel-title"><strong>Manual Steps</strong></div>
      <div class="copybar">
        <button class="btn copy" onclick="copyText('manualBox')">Copy steps</button>
      </div>
      <div id="manualBox" class="mono">
{% if manual_instructions %}
{{ manual_instructions }}
{% else %}
No steps yet. After you build the prompt, we‚Äôll also generate beginner-friendly instructions here.
{% endif %}
      </div>

      <div style="margin-top:22px"></div>
      <h2>Recent Prompts</h2>
      <div class="history-list">
        {% if history and history|length > 0 %}
          {% for h in history %}
          <div class="history-item">
            <div class="h-meta">{{ h.timestamp }} ‚Ä¢ {{ h.app }}</div>
            <div><strong>Task:</strong> {{ h.task }}</div>
            <details style="margin-top:6px">
              <summary>Show context</summary>
              <div class="mono" style="margin-top:6px">{{ h.context }}</div>
            </details>
            <details style="margin-top:6px">
              <summary>Show prompt</summary>
              <div class="mono" style="margin-top:6px">{{ h.prompt }}</div>
            </details>
          </div>
          {% endfor %}
        {% else %}
          <div class="muted">You have no recent prompts yet.</div>
        {% endif %}
      </div>
    </div>

    <div class="footer">SQN Copilot Companion ‚Ä¢ TVA-safe guidance for Microsoft 365</div>
  </div>

  <script>
    function toggleAdv(){document.getElementById('advSection').classList.toggle('show')}
    function fillTask(t){const el=document.getElementById('task'); el.value=t; el.focus()}
    function copyText(id){
      const el=document.getElementById(id); if(!el) return;
      const sel=window.getSelection(), range=document.createRange();
      range.selectNodeContents(el); sel.removeAllRanges(); sel.addRange(range);
      document.execCommand('copy'); sel.removeAllRanges();
      const btns=document.getElementsByClassName('btn copy');
      for (let b of btns){ b.textContent='Copied'; setTimeout(()=> b.textContent='Copy',1200) }
    }
    function scrollToTop(){ window.scrollTo({top:0, behavior:'smooth'}) }
  </script>
</body>
</html>
